---
PrevNote: "[[LLM - æ€»ç»“ç¬”è®°]]"
words:
  2025-02-06: 368
  2025-02-08: 730
  2025-02-09: 559
  2025-02-10: 558
  2025-02-20: 564
  2025-02-21: 605
  2025-05-08: 607
NextNote: "[[æ¥åŠ›èŠå¤©]]"
NIW: è„šæœ¬ç”¨äºä»Giteeæˆ–Githubä¸‹è½½ç´¢å¼•ç¬”è®°ã€è„šæœ¬ç¬”è®°ã€JSä»£ç æˆ–æ’ä»¶ï¼Œæ”¯æŒé€‰æ‹©æ€§ä¸‹è½½å’Œæ‰¹é‡ä¸‹è½½ã€‚
---


æœ¬è„šæœ¬å¯ä»¥æ–¹ä¾¿ä» [[Gitee]] æˆ– [[Github]] ä¸‹è½½ç´¢å¼•ç¬”è®°ã€è„šæœ¬ç¬”è®°ã€JSä»£ç æˆ–æ’ä»¶ã€‚

åœ¨`js //templater' ä»£ç å—ä¸­é…ç½®æƒ³è¦ä¸‹è½½çš„ç¤ºä¾‹åº“ï¼š

```js
let SOURCE = 'gitee'; // gitee æˆ– github
let repoOwner = 'zigholding'; // å¼€å‘è€…
let repoName = 'ObsidianZ'; // é¡¹ç›®åç§°
let path = '__plugins__';  // åˆå§‹è·¯å¾„
let branch = 'master'; // åˆ†æ”¯åç§°
```

è¿è¡Œè„šæœ¬ç¬”è®°ï¼Œä¼šæ˜¾ç¤ºå¼¹çª—ï¼Œå¯¹åº” `path` ä¸‹çš„å­æ–‡ä»¶ï¼š
![[Pasted image 20250209180311.png]]

åœ¨å¼¹çª—ä¸­é€‰æ‹©æƒ³è¦ä¸‹è½½çš„æ–‡ä»¶ã€‚

- ç‚¹å‡»æ–‡ä»¶æ—¶ï¼Œä¼šä¸‹è½½å¯¹åº”çš„æ–‡ä»¶åˆ°æœ¬åœ°åº“ï¼Œè·¯å¾„å’Œ git é¡¹ç›®ä¸€è‡´ï¼›
- ç‚¹å‡»ç›®å½•æ—¶ï¼Œæ–°å¼¹çª—ç½—åˆ—ç›®å½•å­æ–‡ä»¶ï¼Œç»§ç»­ç‚¹å‡»ç›®å½•æˆ–æ–‡ä»¶ï¼Œç›´åˆ°é€‰æ‹©å…·ä½“çš„æ–‡ä»¶ä¸ºæ­¢ï¼›

å¦‚æœæƒ³ä¸‹è½½å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œè¾“å…¥ `all`ï¼Œç‚¹å‡»å›è½¦ç¡®è®¤ã€‚è„šæœ¬ä¼šä¸‹è½½æ‰€æœ‰æ–‡ä»¶ï¼Œä¸åŒ…å«å­ç›®å½•ã€‚

![[Pasted image 20250209180045.png]]

è„šæœ¬ä»£ç ï¼š

```js //templater
let SOURCE = 'gitee'; // gitee
let repoOwner = 'zigholding'; // å¼€å‘è€…
let repoName = 'ObsidianZ'; // é¡¹ç›®åç§°
let path = '__plugins__';  // åˆå§‹è·¯å¾„
let branch = 'master'; // åˆ†æ”¯åç§°

async function list_files_of_path(repoOwner, repoName, path, branch = 'master') {
	let url;
	if(SOURCE=='github'){
		url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${path}?ref=${branch}`;
	}else{
		url = `https://gitee.com/api/v5/repos/${repoOwner}/${repoName}/contents/${path}?ref=${branch}`
	}
	let req = await requestUrl(url)
	req = JSON.parse(req.text)
	if(!Array.isArray(req)){
		req = [req]
	}
	return req
}

async function download_file(url,folder_path,file_name){
	let req = await requestUrl(url)
	// req = JSON.parse(req.text)
	// let ctx = atob(req.content)
	ctx = req.text
	let tfile_path = `${folder_path}/${file_name}`
	// console.log(ctx)
	if(folder_path.startsWith('.')){
		let flag = await app.vault.exists(folder_path);
		if(!flag){
			await app.vault.createFolder(folder_path)
		}
		flag = await app.vault.exists(tfile_path);
		if(!app.vault.exists(tfile_path)){
			await app.vault.adapter.remove(tfile_path)
		}
		tfile = await app.vault.create(tfile_path,ctx)
	}else{
		let folder = app.vault.getFolderByPath(folder_path)
		if(!folder){
			folder = await app.vault.createFolder(folder_path)
		}
		
		let tfile = app.vault.getFileByPath(tfile_path)
		if(!tfile){
			tfile = await app.vault.create(tfile_path,ctx)
			new Notice(`ä¸‹è½½ï¼š${tfile.path}`,5000)
		}else{
			await app.vault.modify(tfile,ctx)
			new Notice(`æ›´æ–°ï¼š${tfile.path}`,5000)
		}
	}
	
}

async function download_file_of_dir(repoOwner, repoName, path, branch){
	let items = await list_files_of_path(repoOwner, repoName, path, branch)
	nc=app.plugins.getPlugin('note-chain');
	let item = await nc.dialog_suggest(
		items.map(x=>(x.type=='file'?'ğŸ“ƒ':'ğŸ“')+x.path),
		items,'',true
	);
	if(!item){return}
	if(typeof(item)=='string' && item=='all'){
		for(let item of items){
			if(item.type=='file'){
				let file_name = item.path.split('/').last();
				let folder_path = item.path.slice(0,item.path.length-file_name.length-1);
				await download_file(item.download_url,folder_path,file_name)
			}
		}
	}else if(item.type=='file'){
		let file_name = item.path.split('/').last();
		let folder_path = item.path.slice(0,item.path.length-file_name.length-1);
		await download_file(item.download_url,folder_path,file_name)
	}else if(item.type=='dir'){
		await download_file_of_dir(repoOwner, repoName, item.path, branch)
	}
}

path = ''; 
download_file_of_dir(repoOwner, repoName, path, branch)
```

