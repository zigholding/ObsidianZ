/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => EasyApiPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian4 = require("obsidian");

// src/strings.ts
var Strings = class {
  constructor() {
    let lang = window.localStorage.getItem("language");
    if (lang) {
      this.language = lang;
    } else {
      this.language = "en";
    }
  }
  get cmd_refresh_llms() {
    if (this.language == "zh") {
      return "\u5237\u65B0\u7FA4\u7EC4";
    } else {
      return "Refresh llms";
    }
  }
  get cmd_open_new_llm() {
    if (this.language == "zh") {
      return "\u6253\u5F00\u65B0AI";
    } else {
      return "Open new llm";
    }
  }
};
var strings = new Strings();

// src/setting.ts
var import_obsidian = require("obsidian");
var DEFAULT_SETTINGS = {
  strict_mode: false,
  vaultDir: ""
};

// src/commands.ts
var commandBuilders = [];
var commandBuildersDesktop = [];
function addCommands(plugin) {
  commandBuilders.forEach((c) => {
    plugin.addCommand(c(plugin));
  });
  if (plugin.app.isMobile == false) {
    commandBuildersDesktop.forEach((c) => {
      console.log("add:", c);
      plugin.addCommand(c(plugin));
    });
  }
}

// src/gui/inputSuggester.ts
var import_obsidian2 = require("obsidian");
var InputSuggester = class extends import_obsidian2.FuzzySuggestModal {
  constructor(app, displayItems, items, options = {}) {
    super(app);
    this.displayItems = displayItems;
    this.items = items;
    this.promise = new Promise((resolve, reject) => {
      this.resolvePromise = resolve;
      this.rejectPromise = reject;
    });
    this.inputEl.addEventListener("keydown", (event) => {
      var _a;
      if (event.code !== "Tab") {
        return;
      }
      const self = this;
      const { values, selectedItem } = self.chooser;
      const { value } = this.inputEl;
      this.inputEl.value = (_a = values[selectedItem].item) != null ? _a : value;
    });
    if (options.placeholder)
      this.setPlaceholder(options.placeholder);
    if (options.limit)
      this.limit = options.limit;
    if (options.emptyStateText)
      this.emptyStateText = options.emptyStateText;
    this.open();
  }
  static Suggest(app, displayItems, items, options = {}) {
    const newSuggester = new InputSuggester(
      app,
      displayItems,
      items,
      options
    );
    return newSuggester.promise;
  }
  getItemText(item) {
    if (item === this.inputEl.value)
      return item;
    return this.displayItems[this.items.indexOf(item)];
  }
  getItems() {
    if (this.inputEl.value === "")
      return this.items;
    return [this.inputEl.value, ...this.items];
  }
  selectSuggestion(value, evt) {
    this.resolved = true;
    super.selectSuggestion(value, evt);
  }
  onChooseItem(item, evt) {
    this.resolved = true;
    this.resolvePromise(item);
  }
  onClose() {
    super.onClose();
    if (!this.resolved)
      this.rejectPromise("no input given.");
  }
};
async function dialog_suggest(displayItems, items, placeholder = "") {
  try {
    return await InputSuggester.Suggest(
      this.app,
      displayItems,
      items,
      {
        placeholder
      }
    );
  } catch (error) {
    return null;
  }
}

// src/gui/inputPrompt.ts
var import_obsidian3 = require("obsidian");
var InputPrompt = class extends import_obsidian3.Modal {
  constructor(app, header, placeholder, value) {
    super(app);
    this.header = header;
    this.didSubmit = false;
    this.submitClickCallback = (evt) => this.submit();
    this.cancelClickCallback = (evt) => this.cancel();
    this.submitEnterCallback = (evt) => {
      if (!evt.isComposing && evt.key === "Enter") {
        evt.preventDefault();
        this.submit();
      }
    };
    this.placeholder = placeholder != null ? placeholder : "";
    this.input = value != null ? value : "";
    this.waitForClose = new Promise((resolve, reject) => {
      this.resolvePromise = resolve;
      this.rejectPromise = reject;
    });
    this.display();
    this.open();
  }
  static Prompt(app, header, placeholder, value) {
    const newPromptModal = new InputPrompt(
      app,
      header,
      placeholder,
      value
    );
    return newPromptModal.waitForClose;
  }
  display() {
    this.containerEl.addClass("quickAddModal", "qaInputPrompt");
    this.contentEl.empty();
    this.titleEl.textContent = this.header;
    const mainContentContainer = this.contentEl.createDiv();
    this.inputComponent = this.createInputField(
      mainContentContainer,
      this.placeholder,
      this.input
    );
    this.createButtonBar(mainContentContainer);
  }
  createInputField(container, placeholder, value) {
    const textComponent = new import_obsidian3.TextComponent(container);
    textComponent.inputEl.classList.add("input-field");
    textComponent.setPlaceholder(placeholder != null ? placeholder : "").setValue(value != null ? value : "").onChange((value2) => this.input = value2).inputEl.addEventListener("keydown", this.submitEnterCallback);
    return textComponent;
  }
  createButton(container, text, callback) {
    const btn = new import_obsidian3.ButtonComponent(container);
    btn.setButtonText(text).onClick(callback);
    return btn;
  }
  createButtonBar(mainContentContainer) {
    const buttonBarContainer = mainContentContainer.createDiv();
    this.createButton(
      buttonBarContainer,
      "Ok",
      this.submitClickCallback
    ).setCta();
    this.createButton(
      buttonBarContainer,
      "Cancel",
      this.cancelClickCallback
    );
    buttonBarContainer.classList.add("button-bar");
  }
  submit() {
    this.didSubmit = true;
    this.close();
  }
  cancel() {
    this.close();
  }
  resolveInput() {
    if (!this.didSubmit)
      this.rejectPromise("No input given.");
    else
      this.resolvePromise(this.input);
  }
  removeInputListener() {
    this.inputComponent.inputEl.removeEventListener(
      "keydown",
      this.submitEnterCallback
    );
  }
  onOpen() {
    super.onOpen();
    this.inputComponent.inputEl.focus();
    this.inputComponent.inputEl.select();
  }
  onClose() {
    super.onClose();
    this.resolveInput();
    this.removeInputListener();
  }
};
async function dialog_prompt(header = "Input", placeholder = "", value = "") {
  try {
    return await InputPrompt.Prompt(
      this.app,
      header,
      placeholder,
      value
    );
  } catch (e) {
    return null;
  }
}

// src/editor.ts
var EasyEditor = class {
  constructor(app, api) {
    this.app = app;
    this.api = api;
  }
  async get_code_section(tfile, ctype = "", idx = 0, as_simple = true) {
    var _a;
    let dvmeta = this.app.metadataCache.getFileCache(tfile);
    let ctx = await this.app.vault.cachedRead(tfile);
    let section = (_a = dvmeta == null ? void 0 : dvmeta.sections) == null ? void 0 : _a.filter((x) => x.type == "code").filter((x) => {
      let c = ctx.slice(x.position.start.offset, x.position.end.offset).trim();
      return c.startsWith("```" + ctype) || c.startsWith("~~~" + ctype);
    })[idx];
    if (section) {
      let c = ctx.slice(
        section.position.start.offset,
        section.position.end.offset
      );
      if (as_simple) {
        return c.slice(4 + ctype.length, c.length - 4);
      } else {
        let res = {
          code: c,
          section,
          ctx
        };
        return res;
      }
    }
  }
};

// src/api.ts
var EasyAPI = class {
  constructor(app) {
    this.app = app;
    this.dialog_suggest = dialog_suggest;
    this.dialog_prompt = dialog_prompt;
    this.editor = new EasyEditor(app, this);
  }
  get_plugin(name) {
    var _a;
    return (_a = this.app.plugins) == null ? void 0 : _a.plugins[name];
  }
  get nc() {
    return this.get_plugin("note-chain");
  }
};

// main.ts
var EasyApiPlugin = class extends import_obsidian4.Plugin {
  async onload() {
    this.app.workspace.onLayoutReady(
      async () => {
        await this._onload_();
      }
    );
  }
  async _onload_() {
    this.strings = new Strings();
    await this.loadSettings();
    this.api = new EasyAPI(this.app);
    this.app.easyapi = this.api;
    addCommands(this);
  }
  onunload() {
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJzcmMvc3RyaW5ncy50cyIsICJzcmMvc2V0dGluZy50cyIsICJzcmMvY29tbWFuZHMudHMiLCAic3JjL2d1aS9pbnB1dFN1Z2dlc3Rlci50cyIsICJzcmMvZ3VpL2lucHV0UHJvbXB0LnRzIiwgInNyYy9lZGl0b3IudHMiLCAic3JjL2FwaS50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHtOb3RpY2UsIFBsdWdpbiwgVEZpbGUsIFRGb2xkZXIgfSBmcm9tICdvYnNpZGlhbic7XHJcblxyXG5pbXBvcnQgeyBTdHJpbmdzIH0gZnJvbSAnc3JjL3N0cmluZ3MnO1xyXG5pbXBvcnQge015U2V0dGluZ3MsREVGQVVMVF9TRVRUSU5HU30gZnJvbSAnc3JjL3NldHRpbmcnXHJcblxyXG5pbXBvcnQgeyBhZGRDb21tYW5kcyB9IGZyb20gJ3NyYy9jb21tYW5kcyc7XHJcbmltcG9ydCB7RWFzeUFQSX0gZnJvbSAnc3JjL2FwaSdcclxuXHJcblxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRWFzeUFwaVBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XHJcblx0c3RyaW5ncyA6IFN0cmluZ3M7XHJcblx0c2V0dGluZ3M6IE15U2V0dGluZ3M7XHJcblx0eWFtbDogc3RyaW5nO1xyXG5cdGRpYWxvZ19zdWdnZXN0OiBGdW5jdGlvblxyXG5cdGRpYWxvZ19wcm9tcHQ6IEZ1bmN0aW9uXHJcblx0YXBpOiBFYXN5QVBJXHJcblxyXG5cclxuXHRhc3luYyBvbmxvYWQoKSB7XHJcblx0XHRcclxuXHRcdHRoaXMuYXBwLndvcmtzcGFjZS5vbkxheW91dFJlYWR5KFxyXG5cdFx0XHRhc3luYygpPT57XHJcblx0XHRcdFx0YXdhaXQgdGhpcy5fb25sb2FkXygpXHJcblx0XHRcdH1cclxuXHRcdClcclxuXHR9XHJcblxyXG5cdGFzeW5jIF9vbmxvYWRfKCkge1xyXG5cdFx0Ly8gXHU1MjFEXHU1OUNCXHU1OUNCXHU1MzE2XHVGRjBDXHU1MkEwXHU4RjdEXHU0RTJEXHU4MkYxXHU2NTg3XHU1NDhDXHU1M0MyXHU2NTcwXHJcblx0XHR0aGlzLnN0cmluZ3MgPSBuZXcgU3RyaW5ncygpO1xyXG5cdFx0YXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcclxuXHJcblx0XHR0aGlzLmFwaSA9IG5ldyBFYXN5QVBJKHRoaXMuYXBwKTtcclxuXHRcdFxyXG5cdFx0dGhpcy5hcHAuZWFzeWFwaSA9IHRoaXMuYXBpO1xyXG5cdFx0XHJcblx0XHQvLyBcdTZERkJcdTUyQTBcdTU0N0RcdTRFRTRcclxuXHRcdGFkZENvbW1hbmRzKHRoaXMpO1xyXG5cclxuXHR9XHJcblxyXG5cdG9udW5sb2FkKCkge1xyXG5cdFx0XHJcblx0fVxyXG5cclxuXHRhc3luYyBsb2FkU2V0dGluZ3MoKSB7XHJcblx0XHR0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcclxuXHR9XHJcblxyXG5cdGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcclxuXHRcdGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XHJcblx0fVxyXG5cclxufVxyXG4iLCAiXHJcbmV4cG9ydCBjbGFzcyBTdHJpbmdze1xyXG4gICAgbGFuZ3VhZ2U6c3RyaW5nO1xyXG4gICAgY29uc3RydWN0b3IoKXtcclxuICAgICAgICBsZXQgbGFuZyA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbGFuZ3VhZ2UnKTtcclxuICAgICAgICBpZihsYW5nKXtcclxuICAgICAgICAgICAgdGhpcy5sYW5ndWFnZSA9IGxhbmc7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHRoaXMubGFuZ3VhZ2UgPSAnZW4nO1xyXG4gICAgICAgIH1cclxuXHR9XHJcblxyXG4gICAgZ2V0IGNtZF9yZWZyZXNoX2xsbXMoKXtcclxuICAgICAgICBpZih0aGlzLmxhbmd1YWdlPT0nemgnKXtcclxuICAgICAgICAgICAgcmV0dXJuICdcdTUyMzdcdTY1QjBcdTdGQTRcdTdFQzQnXHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHJldHVybiAnUmVmcmVzaCBsbG1zJztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGNtZF9vcGVuX25ld19sbG0oKXtcclxuICAgICAgICBpZih0aGlzLmxhbmd1YWdlPT0nemgnKXtcclxuICAgICAgICAgICAgcmV0dXJuICdcdTYyNTNcdTVGMDBcdTY1QjBBSSdcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgcmV0dXJuICdPcGVuIG5ldyBsbG0nO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGxldCBzdHJpbmdzID0gbmV3IFN0cmluZ3MoKTsiLCAiaW1wb3J0IHsgXHJcblx0QXBwLCBQbHVnaW5TZXR0aW5nVGFiLCBTZXR0aW5nLFBsdWdpblxyXG59IGZyb20gJ29ic2lkaWFuJztcclxuXHJcbmltcG9ydCBFYXN5QXBpUGx1Z2luIGZyb20gJy4uL21haW4nO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBNeVNldHRpbmdzIHtcclxuXHRzdHJpY3RfbW9kZTogYm9vbGVhbjtcclxuXHR2YXVsdERpcjpzdHJpbmc7XHJcblx0ZGVlcHNlZWtGb2xkZXI6IHN0cmluZztcclxuXHRkb3ViYW9Gb2xkZXI6IHN0cmluZztcclxuXHRraW1pRm9sZGVyOiBzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBERUZBVUxUX1NFVFRJTkdTOiBNeVNldHRpbmdzID0ge1xyXG5cdHN0cmljdF9tb2RlOmZhbHNlLFxyXG5cdHZhdWx0RGlyOicnXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBXZWJWaWV3TExNU2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xyXG5cdHBsdWdpbjogRWFzeUFwaVBsdWdpbjtcclxuXHRjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBFYXN5QXBpUGx1Z2luKSB7XHJcblx0XHRzdXBlcihhcHAsIHBsdWdpbik7XHJcblx0XHR0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuXHR9XHJcblxyXG5cdGdldFNldHRpbmdWYWx1ZShmaWVsZDoga2V5b2YgTXlTZXR0aW5ncykge1xyXG5cdFx0cmV0dXJuIHRoaXMucGx1Z2luLnNldHRpbmdzW2ZpZWxkXTtcclxuXHR9XHJcblxyXG5cdGFkZF90b2dnbGUobmFtZTpzdHJpbmcsZGVzYzpzdHJpbmcsZmllbGQ6a2V5b2YgTXlTZXR0aW5ncyl7XHJcblx0XHRsZXQge2NvbnRhaW5lckVsfSA9IHRoaXM7XHJcblx0XHRsZXQgdmFsdWUgPSAodGhpcy5wbHVnaW4uc2V0dGluZ3MgYXMgYW55KVtmaWVsZF0gYXMgYm9vbGVhbjtcclxuXHRcdGxldCBpdGVtID0gbmV3IFNldHRpbmcoY29udGFpbmVyRWwpICBcclxuXHRcdFx0LnNldE5hbWUobmFtZSlcclxuXHRcdFx0LnNldERlc2MoZGVzYylcclxuXHRcdFx0LmFkZFRvZ2dsZSh0ZXh0ID0+IHRleHRcclxuXHRcdFx0XHQuc2V0VmFsdWUodmFsdWUpXHJcblx0XHRcdFx0Lm9uQ2hhbmdlKGFzeW5jICh2YWx1ZTpuZXZlcikgPT4ge1xyXG5cdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3NbZmllbGRdID0gdmFsdWU7XHJcblx0XHRcdFx0XHRhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuXHRcdFx0XHR9KVxyXG5cdFx0XHQpO1xyXG5cdFx0cmV0dXJuIGl0ZW07XHJcblx0fVxyXG5cclxuXHRkaXNwbGF5KCk6IHZvaWQge1xyXG5cdFx0Y29uc3Qge2NvbnRhaW5lckVsfSA9IHRoaXM7XHJcblxyXG5cdFx0Y29udGFpbmVyRWwuZW1wdHkoKTtcclxuXHRcdFxyXG5cdFx0bmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcblx0XHRcdFx0LnNldE5hbWUodGhpcy5wbHVnaW4uc3RyaW5ncy5zZXR0aW5nX3ZhdWx0X2RpcilcclxuXHRcdFx0XHQuYWRkVGV4dEFyZWEodGV4dCA9PiB0ZXh0XHJcblx0XHRcdFx0XHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MudmF1bHREaXIpXHJcblx0XHRcdFx0XHQub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcblx0XHRcdFx0XHRcdHRoaXMucGx1Z2luLnNldHRpbmdzLnZhdWx0RGlyID0gdmFsdWU7XHJcblx0XHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG5cdFx0XHRcdFx0fSkpO1xyXG5cdFx0XHRcdFx0XHJcblx0XHR0aGlzLmFkZF90b2dnbGUoXHJcblx0XHRcdHRoaXMucGx1Z2luLnN0cmluZ3Muc2V0dGluZ19zdHJpY3RfbW9kZSxcclxuXHRcdFx0dGhpcy5wbHVnaW4uc3RyaW5ncy5zZXR0aW5nX3N0cmljdF9tb2RlX2Rlc2MsXHJcblx0XHRcdCdzdHJpY3RfbW9kZSdcclxuXHRcdCk7XHJcblx0fVxyXG59XHJcbiIsICJpbXBvcnQgeyBcclxuXHROb3RpY2UsIFRGaWxlXHJcbn0gZnJvbSAnb2JzaWRpYW4nO1xyXG5cclxuaW1wb3J0IEVhc3lBcGlQbHVnaW4gZnJvbSAnLi4vbWFpbic7XHJcblxyXG5jb25zdCBjb21tYW5kQnVpbGRlcnM6QXJyYXk8RnVuY3Rpb24+ID0gW1xyXG4gICAgXHJcbl07XHJcblxyXG5jb25zdCBjb21tYW5kQnVpbGRlcnNEZXNrdG9wOkFycmF5PEZ1bmN0aW9uPiA9IFtcclxuXHJcbl07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYWRkQ29tbWFuZHMocGx1Z2luOkVhc3lBcGlQbHVnaW4pIHtcclxuICAgIGNvbW1hbmRCdWlsZGVycy5mb3JFYWNoKChjKSA9PiB7XHJcbiAgICAgICAgcGx1Z2luLmFkZENvbW1hbmQoYyhwbHVnaW4pKTtcclxuICAgIH0pO1xyXG5cdGlmKChwbHVnaW4uYXBwIGFzIGFueSkuaXNNb2JpbGU9PWZhbHNlKXtcclxuXHRcdGNvbW1hbmRCdWlsZGVyc0Rlc2t0b3AuZm9yRWFjaCgoYykgPT4ge1xyXG5cdFx0XHRjb25zb2xlLmxvZygnYWRkOicsYylcclxuXHRcdFx0cGx1Z2luLmFkZENvbW1hbmQoYyhwbHVnaW4pKTtcclxuXHRcdH0pO1xyXG5cdH1cclxufSIsICJpbXBvcnQgeyBGdXp6eVN1Z2dlc3RNb2RhbCB9IGZyb20gXCJvYnNpZGlhblwiO1xyXG5pbXBvcnQgdHlwZSB7IEZ1enp5TWF0Y2ggLCBBcHB9IGZyb20gXCJvYnNpZGlhblwiO1xyXG5cclxuLy8gXHU2REZCXHU1MkEwXHU3QzdCXHU1NzhCXHU1OEYwXHU2NjBFXHJcbmludGVyZmFjZSBTdWdnZXN0ZXJDaG9vc2VyIHtcclxuXHR2YWx1ZXM6IHtcclxuXHRcdGl0ZW06IHN0cmluZztcclxuXHRcdG1hdGNoOiB7IHNjb3JlOiBudW1iZXI7IG1hdGNoZXM6IHVua25vd25bXSB9O1xyXG5cdH1bXTtcclxuXHRzZWxlY3RlZEl0ZW06IG51bWJlcjtcclxuXHRba2V5OiBzdHJpbmddOiB1bmtub3duO1xyXG59XHJcblxyXG4vLyBcdTYyNjlcdTVDNTVGdXp6eVN1Z2dlc3RNb2RhbFx1NzY4NFx1N0M3Qlx1NTc4QlxyXG5pbnRlcmZhY2UgRXh0ZW5kZWRGdXp6eVN1Z2dlc3RNb2RhbCBleHRlbmRzIEZ1enp5U3VnZ2VzdE1vZGFsPHN0cmluZz4ge1xyXG5cdGNob29zZXI6IFN1Z2dlc3RlckNob29zZXI7XHJcbn1cclxuXHJcbnR5cGUgT3B0aW9ucyA9IHtcclxuXHRsaW1pdDogRnV6enlTdWdnZXN0TW9kYWw8c3RyaW5nPltcImxpbWl0XCJdO1xyXG5cdGVtcHR5U3RhdGVUZXh0OiBGdXp6eVN1Z2dlc3RNb2RhbDxzdHJpbmc+W1wiZW1wdHlTdGF0ZVRleHRcIl07XHJcblx0cGxhY2Vob2xkZXI6IFBhcmFtZXRlcnM8XHJcblx0XHRGdXp6eVN1Z2dlc3RNb2RhbDxzdHJpbmc+W1wic2V0UGxhY2Vob2xkZXJcIl1cclxuXHQ+WzBdIGV4dGVuZHMgc3RyaW5nXHJcblx0XHQ/IHN0cmluZ1xyXG5cdFx0OiBuZXZlcjtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDb3B5IGZyb20gUXVpY2tBZGRcclxuICovXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIElucHV0U3VnZ2VzdGVyIGV4dGVuZHMgRnV6enlTdWdnZXN0TW9kYWw8c3RyaW5nPiB7XHJcblx0cHJpdmF0ZSByZXNvbHZlUHJvbWlzZTogKHZhbHVlOiBzdHJpbmcpID0+IHZvaWQ7XHJcblx0cHJpdmF0ZSByZWplY3RQcm9taXNlOiAocmVhc29uPzogdW5rbm93bikgPT4gdm9pZDtcclxuXHRwdWJsaWMgcHJvbWlzZTogUHJvbWlzZTxzdHJpbmc+O1xyXG5cdHByaXZhdGUgcmVzb2x2ZWQ6IGJvb2xlYW47XHJcblx0aW5wdXRFbDogYW55O1xyXG5cclxuXHRwdWJsaWMgc3RhdGljIFN1Z2dlc3QoXHJcblx0XHRhcHA6IEFwcCxcclxuXHRcdGRpc3BsYXlJdGVtczogc3RyaW5nW10sXHJcblx0XHRpdGVtczogc3RyaW5nW10sXHJcblx0XHRvcHRpb25zOiBQYXJ0aWFsPE9wdGlvbnM+ID0ge31cclxuXHQpIHtcclxuXHRcdGNvbnN0IG5ld1N1Z2dlc3RlciA9IG5ldyBJbnB1dFN1Z2dlc3RlcihcclxuXHRcdFx0YXBwLFxyXG5cdFx0XHRkaXNwbGF5SXRlbXMsXHJcblx0XHRcdGl0ZW1zLFxyXG5cdFx0XHRvcHRpb25zXHJcblx0XHQpO1xyXG5cdFx0cmV0dXJuIG5ld1N1Z2dlc3Rlci5wcm9taXNlO1xyXG5cdH1cclxuXHJcblx0cHVibGljIGNvbnN0cnVjdG9yKFxyXG5cdFx0YXBwOiBBcHAsXHJcblx0XHRwcml2YXRlIGRpc3BsYXlJdGVtczogc3RyaW5nW10sXHJcblx0XHRwcml2YXRlIGl0ZW1zOiBzdHJpbmdbXSxcclxuXHRcdG9wdGlvbnM6IFBhcnRpYWw8T3B0aW9ucz4gPSB7fVxyXG5cdCkge1xyXG5cdFx0c3VwZXIoYXBwKTtcclxuXHJcblx0XHR0aGlzLnByb21pc2UgPSBuZXcgUHJvbWlzZTxzdHJpbmc+KChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuXHRcdFx0dGhpcy5yZXNvbHZlUHJvbWlzZSA9IHJlc29sdmU7XHJcblx0XHRcdHRoaXMucmVqZWN0UHJvbWlzZSA9IHJlamVjdDtcclxuXHRcdH0pO1xyXG5cclxuXHRcdHRoaXMuaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZXZlbnQ6IEtleWJvYXJkRXZlbnQpID0+IHtcclxuXHRcdFx0aWYgKGV2ZW50LmNvZGUgIT09IFwiVGFiXCIpIHtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIFx1NEY3Rlx1NzUyOFx1N0M3Qlx1NTc4Qlx1NjVBRFx1OEEwMFx1Njc2NVx1OEJCRlx1OTVFRWNob29zZXJcclxuXHRcdFx0Y29uc3Qgc2VsZiA9IHRoaXMgYXMgdW5rbm93biBhcyBFeHRlbmRlZEZ1enp5U3VnZ2VzdE1vZGFsO1xyXG5cdFx0XHRjb25zdCB7IHZhbHVlcywgc2VsZWN0ZWRJdGVtIH0gPSBzZWxmLmNob29zZXI7XHJcblxyXG5cdFx0XHRjb25zdCB7IHZhbHVlIH0gPSB0aGlzLmlucHV0RWw7XHJcblx0XHRcdHRoaXMuaW5wdXRFbC52YWx1ZSA9IHZhbHVlc1tzZWxlY3RlZEl0ZW1dLml0ZW0gPz8gdmFsdWU7XHJcblx0XHR9KTtcclxuXHJcblx0XHRpZiAob3B0aW9ucy5wbGFjZWhvbGRlcikgdGhpcy5zZXRQbGFjZWhvbGRlcihvcHRpb25zLnBsYWNlaG9sZGVyKTtcclxuXHRcdGlmIChvcHRpb25zLmxpbWl0KSB0aGlzLmxpbWl0ID0gb3B0aW9ucy5saW1pdDtcclxuXHRcdGlmIChvcHRpb25zLmVtcHR5U3RhdGVUZXh0KVxyXG5cdFx0XHR0aGlzLmVtcHR5U3RhdGVUZXh0ID0gb3B0aW9ucy5lbXB0eVN0YXRlVGV4dDtcclxuXHJcblx0XHR0aGlzLm9wZW4oKTtcclxuXHR9XHJcblxyXG5cdGdldEl0ZW1UZXh0KGl0ZW06IHN0cmluZyk6IHN0cmluZyB7XHJcblx0XHRpZiAoaXRlbSA9PT0gdGhpcy5pbnB1dEVsLnZhbHVlKSByZXR1cm4gaXRlbTtcclxuXHJcblx0XHRyZXR1cm4gdGhpcy5kaXNwbGF5SXRlbXNbdGhpcy5pdGVtcy5pbmRleE9mKGl0ZW0pXTtcclxuXHR9XHJcblxyXG5cdGdldEl0ZW1zKCk6IHN0cmluZ1tdIHtcclxuXHRcdGlmICh0aGlzLmlucHV0RWwudmFsdWUgPT09IFwiXCIpIHJldHVybiB0aGlzLml0ZW1zO1xyXG5cdFx0cmV0dXJuIFt0aGlzLmlucHV0RWwudmFsdWUsIC4uLnRoaXMuaXRlbXNdO1xyXG5cdH1cclxuXHJcblx0c2VsZWN0U3VnZ2VzdGlvbihcclxuXHRcdHZhbHVlOiBGdXp6eU1hdGNoPHN0cmluZz4sXHJcblx0XHRldnQ6IE1vdXNlRXZlbnQgfCBLZXlib2FyZEV2ZW50XHJcblx0KSB7XHJcblx0XHR0aGlzLnJlc29sdmVkID0gdHJ1ZTtcclxuXHRcdHN1cGVyLnNlbGVjdFN1Z2dlc3Rpb24odmFsdWUsIGV2dCk7XHJcblx0fVxyXG5cclxuXHRvbkNob29zZUl0ZW0oaXRlbTogc3RyaW5nLCBldnQ6IE1vdXNlRXZlbnQgfCBLZXlib2FyZEV2ZW50KTogdm9pZCB7XHJcblx0XHR0aGlzLnJlc29sdmVkID0gdHJ1ZTtcclxuXHRcdHRoaXMucmVzb2x2ZVByb21pc2UoaXRlbSk7XHJcblx0fVxyXG5cclxuXHRvbkNsb3NlKCkge1xyXG5cdFx0c3VwZXIub25DbG9zZSgpO1xyXG5cclxuXHRcdGlmICghdGhpcy5yZXNvbHZlZCkgdGhpcy5yZWplY3RQcm9taXNlKFwibm8gaW5wdXQgZ2l2ZW4uXCIpO1xyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRpYWxvZ19zdWdnZXN0KGRpc3BsYXlJdGVtczpBcnJheTxzdHJpbmc+LGl0ZW1zOkFycmF5PGFueT4scGxhY2Vob2xkZXI9JycpIHtcclxuXHR0cnl7XHJcblx0XHRyZXR1cm4gYXdhaXQgSW5wdXRTdWdnZXN0ZXIuU3VnZ2VzdChcclxuXHRcdFx0dGhpcy5hcHAsXHJcblx0XHRcdGRpc3BsYXlJdGVtcyxcclxuXHRcdFx0aXRlbXMsXHJcblx0XHRcdHtcclxuXHRcdFx0XHRwbGFjZWhvbGRlcjogcGxhY2Vob2xkZXIsXHJcblx0XHRcdH1cclxuXHRcdClcclxuXHR9Y2F0Y2goZXJyb3Ipe1xyXG5cdFx0XHJcblx0XHRyZXR1cm4gbnVsbFxyXG5cdH1cclxuXHRcclxufVxyXG4iLCAiaW1wb3J0IHR5cGUgeyBBcHB9IGZyb20gXCJvYnNpZGlhblwiO1xyXG5pbXBvcnQgeyBCdXR0b25Db21wb25lbnQsIE1vZGFsLCBUZXh0Q29tcG9uZW50IH0gZnJvbSBcIm9ic2lkaWFuXCI7XHJcblxyXG4vKipcclxuICogQ29weSBmcm9tIFF1aWNrQWRkXHJcbiAqL1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSW5wdXRQcm9tcHQgZXh0ZW5kcyBNb2RhbCB7XHJcblx0cHVibGljIHdhaXRGb3JDbG9zZTogUHJvbWlzZTxzdHJpbmc+O1xyXG5cclxuXHRwcml2YXRlIHJlc29sdmVQcm9taXNlOiAoaW5wdXQ6IHN0cmluZykgPT4gdm9pZDtcclxuXHRwcml2YXRlIHJlamVjdFByb21pc2U6IChyZWFzb24/OiB1bmtub3duKSA9PiB2b2lkO1xyXG5cdHByaXZhdGUgZGlkU3VibWl0ID0gZmFsc2U7XHJcblx0cHJpdmF0ZSBpbnB1dENvbXBvbmVudDogVGV4dENvbXBvbmVudDtcclxuXHRwcml2YXRlIGlucHV0OiBzdHJpbmc7XHJcblx0cHJpdmF0ZSByZWFkb25seSBwbGFjZWhvbGRlcjogc3RyaW5nO1xyXG5cclxuXHRwdWJsaWMgc3RhdGljIFByb21wdChcclxuXHRcdGFwcDogQXBwLFxyXG5cdFx0aGVhZGVyOiBzdHJpbmcsXHJcblx0XHRwbGFjZWhvbGRlcj86IHN0cmluZyxcclxuXHRcdHZhbHVlPzogc3RyaW5nXHJcblx0KTogUHJvbWlzZTxzdHJpbmc+IHtcclxuXHRcdGNvbnN0IG5ld1Byb21wdE1vZGFsID0gbmV3IElucHV0UHJvbXB0KFxyXG5cdFx0XHRhcHAsXHJcblx0XHRcdGhlYWRlcixcclxuXHRcdFx0cGxhY2Vob2xkZXIsXHJcblx0XHRcdHZhbHVlXHJcblx0XHQpO1xyXG5cdFx0cmV0dXJuIG5ld1Byb21wdE1vZGFsLndhaXRGb3JDbG9zZTtcclxuXHR9XHJcblxyXG5cdHByb3RlY3RlZCBjb25zdHJ1Y3RvcihcclxuXHRcdGFwcDogQXBwLFxyXG5cdFx0cHJpdmF0ZSBoZWFkZXI6IHN0cmluZyxcclxuXHRcdHBsYWNlaG9sZGVyPzogc3RyaW5nLFxyXG5cdFx0dmFsdWU/OiBzdHJpbmdcclxuXHQpIHtcclxuXHRcdHN1cGVyKGFwcCk7XHJcblx0XHR0aGlzLnBsYWNlaG9sZGVyID0gcGxhY2Vob2xkZXIgPz8gXCJcIjtcclxuXHRcdHRoaXMuaW5wdXQgPSB2YWx1ZSA/PyBcIlwiO1xyXG5cclxuXHRcdHRoaXMud2FpdEZvckNsb3NlID0gbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblx0XHRcdHRoaXMucmVzb2x2ZVByb21pc2UgPSByZXNvbHZlO1xyXG5cdFx0XHR0aGlzLnJlamVjdFByb21pc2UgPSByZWplY3Q7XHJcblx0XHR9KTtcclxuXHJcblx0XHR0aGlzLmRpc3BsYXkoKTtcclxuXHRcdHRoaXMub3BlbigpO1xyXG5cclxuXHR9XHJcblxyXG5cdHByaXZhdGUgZGlzcGxheSgpIHtcclxuXHRcdHRoaXMuY29udGFpbmVyRWwuYWRkQ2xhc3MoXCJxdWlja0FkZE1vZGFsXCIsIFwicWFJbnB1dFByb21wdFwiKTtcclxuXHRcdHRoaXMuY29udGVudEVsLmVtcHR5KCk7XHJcblx0XHR0aGlzLnRpdGxlRWwudGV4dENvbnRlbnQgPSB0aGlzLmhlYWRlcjtcclxuXHJcblx0XHRjb25zdCBtYWluQ29udGVudENvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQgPSB0aGlzLmNvbnRlbnRFbC5jcmVhdGVEaXYoKTtcclxuXHRcdHRoaXMuaW5wdXRDb21wb25lbnQgPSB0aGlzLmNyZWF0ZUlucHV0RmllbGQoXHJcblx0XHRcdG1haW5Db250ZW50Q29udGFpbmVyLFxyXG5cdFx0XHR0aGlzLnBsYWNlaG9sZGVyLFxyXG5cdFx0XHR0aGlzLmlucHV0XHJcblx0XHQpO1xyXG5cdFx0dGhpcy5jcmVhdGVCdXR0b25CYXIobWFpbkNvbnRlbnRDb250YWluZXIpO1xyXG5cdH1cclxuXHJcblx0cHJvdGVjdGVkIGNyZWF0ZUlucHV0RmllbGQoXHJcblx0XHRjb250YWluZXI6IEhUTUxFbGVtZW50LFxyXG5cdFx0cGxhY2Vob2xkZXI/OiBzdHJpbmcsXHJcblx0XHR2YWx1ZT86IHN0cmluZ1xyXG5cdCkge1xyXG5cdFx0Y29uc3QgdGV4dENvbXBvbmVudCA9IG5ldyBUZXh0Q29tcG9uZW50KGNvbnRhaW5lcik7XHJcblx0XHQodGV4dENvbXBvbmVudCBhcyBhbnkpLmlucHV0RWwuY2xhc3NMaXN0LmFkZChcImlucHV0LWZpZWxkXCIpOyBcclxuXHRcdCh0ZXh0Q29tcG9uZW50IGFzIGFueSlcclxuXHRcdFx0LnNldFBsYWNlaG9sZGVyKHBsYWNlaG9sZGVyID8/IFwiXCIpXHJcblx0XHRcdC5zZXRWYWx1ZSh2YWx1ZSA/PyBcIlwiKVxyXG5cdFx0XHQub25DaGFuZ2UoKHZhbHVlOnN0cmluZykgPT4gKHRoaXMuaW5wdXQgPSB2YWx1ZSkpXHJcblx0XHRcdC5pbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuc3VibWl0RW50ZXJDYWxsYmFjayk7XHJcblxyXG5cdFx0cmV0dXJuIHRleHRDb21wb25lbnQ7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIGNyZWF0ZUJ1dHRvbihcclxuXHRcdGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsXHJcblx0XHR0ZXh0OiBzdHJpbmcsXHJcblx0XHRjYWxsYmFjazogKGV2dDogTW91c2VFdmVudCkgPT4gdW5rbm93blxyXG5cdCkge1xyXG5cdFx0Y29uc3QgYnRuID0gbmV3IEJ1dHRvbkNvbXBvbmVudChjb250YWluZXIpO1xyXG5cdFx0YnRuLnNldEJ1dHRvblRleHQodGV4dCkub25DbGljayhjYWxsYmFjayk7XHJcblxyXG5cdFx0cmV0dXJuIGJ0bjtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgY3JlYXRlQnV0dG9uQmFyKG1haW5Db250ZW50Q29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCkge1xyXG5cdFx0Y29uc3QgYnV0dG9uQmFyQ29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCA9XHJcblx0XHRcdG1haW5Db250ZW50Q29udGFpbmVyLmNyZWF0ZURpdigpO1xyXG5cdFx0dGhpcy5jcmVhdGVCdXR0b24oXHJcblx0XHRcdGJ1dHRvbkJhckNvbnRhaW5lcixcclxuXHRcdFx0XCJPa1wiLFxyXG5cdFx0XHR0aGlzLnN1Ym1pdENsaWNrQ2FsbGJhY2tcclxuXHRcdCkuc2V0Q3RhKCk7XHJcblx0XHR0aGlzLmNyZWF0ZUJ1dHRvbihcclxuXHRcdFx0YnV0dG9uQmFyQ29udGFpbmVyLFxyXG5cdFx0XHRcIkNhbmNlbFwiLFxyXG5cdFx0XHR0aGlzLmNhbmNlbENsaWNrQ2FsbGJhY2tcclxuXHRcdCk7XHJcblxyXG5cdFx0YnV0dG9uQmFyQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJidXR0b24tYmFyXCIpO1xyXG5cdFx0XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIHN1Ym1pdENsaWNrQ2FsbGJhY2sgPSAoZXZ0OiBNb3VzZUV2ZW50KSA9PiB0aGlzLnN1Ym1pdCgpO1xyXG5cdHByaXZhdGUgY2FuY2VsQ2xpY2tDYWxsYmFjayA9IChldnQ6IE1vdXNlRXZlbnQpID0+IHRoaXMuY2FuY2VsKCk7XHJcblxyXG5cdHByaXZhdGUgc3VibWl0RW50ZXJDYWxsYmFjayA9IChldnQ6IEtleWJvYXJkRXZlbnQpID0+IHtcclxuXHRcdGlmICghZXZ0LmlzQ29tcG9zaW5nICYmIGV2dC5rZXkgPT09IFwiRW50ZXJcIikge1xyXG5cdFx0XHRldnQucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0dGhpcy5zdWJtaXQoKTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRwcml2YXRlIHN1Ym1pdCgpIHtcclxuXHRcdHRoaXMuZGlkU3VibWl0ID0gdHJ1ZTtcclxuXHJcblx0XHR0aGlzLmNsb3NlKCk7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIGNhbmNlbCgpIHtcclxuXHRcdHRoaXMuY2xvc2UoKTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgcmVzb2x2ZUlucHV0KCkge1xyXG5cdFx0aWYgKCF0aGlzLmRpZFN1Ym1pdCkgdGhpcy5yZWplY3RQcm9taXNlKFwiTm8gaW5wdXQgZ2l2ZW4uXCIpO1xyXG5cdFx0ZWxzZSB0aGlzLnJlc29sdmVQcm9taXNlKHRoaXMuaW5wdXQpO1xyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSByZW1vdmVJbnB1dExpc3RlbmVyKCkge1xyXG5cdFx0dGhpcy5pbnB1dENvbXBvbmVudC5pbnB1dEVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoXHJcblx0XHRcdFwia2V5ZG93blwiLFxyXG5cdFx0XHR0aGlzLnN1Ym1pdEVudGVyQ2FsbGJhY2tcclxuXHRcdCk7XHJcblx0fVxyXG5cclxuXHRvbk9wZW4oKSB7XHJcblx0XHRzdXBlci5vbk9wZW4oKTtcclxuXHJcblx0XHR0aGlzLmlucHV0Q29tcG9uZW50LmlucHV0RWwuZm9jdXMoKTtcclxuXHRcdHRoaXMuaW5wdXRDb21wb25lbnQuaW5wdXRFbC5zZWxlY3QoKTtcclxuXHR9XHJcblxyXG5cdG9uQ2xvc2UoKSB7XHJcblx0XHRzdXBlci5vbkNsb3NlKCk7XHJcblx0XHR0aGlzLnJlc29sdmVJbnB1dCgpO1xyXG5cdFx0dGhpcy5yZW1vdmVJbnB1dExpc3RlbmVyKCk7XHJcblx0fVxyXG59XHJcblxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRpYWxvZ19wcm9tcHQoaGVhZGVyOiBzdHJpbmc9J0lucHV0JywgcGxhY2Vob2xkZXI6IHN0cmluZz0nJyx2YWx1ZTpzdHJpbmc9JycpIHtcclxuXHR0cnl7XHJcblx0XHRyZXR1cm4gYXdhaXQgSW5wdXRQcm9tcHQuUHJvbXB0KFxyXG5cdFx0XHR0aGlzLmFwcCxcclxuXHRcdFx0aGVhZGVyLFxyXG5cdFx0XHRwbGFjZWhvbGRlcixcclxuICAgICAgICAgICAgdmFsdWVcclxuXHRcdClcclxuXHR9Y2F0Y2h7XHJcblx0XHRyZXR1cm4gbnVsbFxyXG5cdH1cclxufVxyXG4iLCAiXHJcblxyXG5cclxuaW1wb3J0IHsgQXBwLCBWaWV3LCBXb3Jrc3BhY2VMZWFmLFRGaWxlIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5cclxuaW1wb3J0IHtFYXN5QVBJfSBmcm9tICdzcmMvYXBpJ1xyXG5cclxuZXhwb3J0IGNsYXNzIEVhc3lFZGl0b3Ige1xyXG4gICAgYXBwOiBBcHA7XHJcbiAgICBhcGk6IEVhc3lBUEk7XHJcblxyXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIGFwaTpFYXN5QVBJKSB7XHJcbiAgICAgICAgdGhpcy5hcHAgPSBhcHA7XHJcbiAgICAgICAgdGhpcy5hcGkgPSBhcGk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGFzeW5jIGdldF9jb2RlX3NlY3Rpb24odGZpbGU6VEZpbGUsY3R5cGU9JycsaWR4PTAsYXNfc2ltcGxlPXRydWUpe1xyXG4gICAgICAgIGxldCBkdm1ldGEgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZSh0ZmlsZSk7XHJcbiAgICAgICAgbGV0IGN0eCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNhY2hlZFJlYWQodGZpbGUpO1xyXG4gICAgICAgIGxldCBzZWN0aW9uID0gZHZtZXRhPy5zZWN0aW9ucz8uZmlsdGVyKHg9PngudHlwZT09J2NvZGUnKS5maWx0ZXIoeD0+e1xyXG4gICAgICAgICAgICBsZXQgYyA9IGN0eC5zbGljZSh4LnBvc2l0aW9uLnN0YXJ0Lm9mZnNldCx4LnBvc2l0aW9uLmVuZC5vZmZzZXQpLnRyaW0oKTtcclxuICAgICAgICAgICAgcmV0dXJuIGMuc3RhcnRzV2l0aCgnYGBgJytjdHlwZSkgfHwgYy5zdGFydHNXaXRoKCd+fn4nK2N0eXBlKTtcclxuICAgICAgICB9KVtpZHhdXHJcbiAgICAgICAgaWYoc2VjdGlvbil7XHJcbiAgICAgICAgICAgIGxldCBjID0gY3R4LnNsaWNlKFxyXG4gICAgICAgICAgICAgICAgc2VjdGlvbi5wb3NpdGlvbi5zdGFydC5vZmZzZXQsXHJcbiAgICAgICAgICAgICAgICBzZWN0aW9uLnBvc2l0aW9uLmVuZC5vZmZzZXRcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmKGFzX3NpbXBsZSl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYy5zbGljZSg0K2N0eXBlLmxlbmd0aCxjLmxlbmd0aC00KVxyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIGxldCByZXMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29kZTpjLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlY3Rpb246c2VjdGlvbixcclxuICAgICAgICAgICAgICAgICAgICBjdHg6Y3R4XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG4iLCAiXHJcblxyXG5pbXBvcnQgeyBBcHAsIFZpZXcsIFdvcmtzcGFjZUxlYWYgfSBmcm9tICdvYnNpZGlhbic7XHJcblxyXG5pbXBvcnQge2RpYWxvZ19zdWdnZXN0fSBmcm9tICdzcmMvZ3VpL2lucHV0U3VnZ2VzdGVyJ1xyXG5pbXBvcnQge2RpYWxvZ19wcm9tcHR9IGZyb20gJ3NyYy9ndWkvaW5wdXRQcm9tcHQnXHJcbmltcG9ydCB7IEVhc3lFZGl0b3IgfSBmcm9tICcuL2VkaXRvcic7XHJcblxyXG5leHBvcnQgY2xhc3MgRWFzeUFQSSB7XHJcbiAgICBhcHA6IEFwcDtcclxuICAgIGRpYWxvZ19zdWdnZXN0OiBGdW5jdGlvblxyXG5cdGRpYWxvZ19wcm9tcHQ6IEZ1bmN0aW9uXHJcbiAgICBlZGl0b3I6IEVhc3lFZGl0b3JcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCkge1xyXG4gICAgICAgIHRoaXMuYXBwID0gYXBwO1xyXG4gICAgICAgIHRoaXMuZGlhbG9nX3N1Z2dlc3QgPSBkaWFsb2dfc3VnZ2VzdDtcclxuXHRcdHRoaXMuZGlhbG9nX3Byb21wdCA9IGRpYWxvZ19wcm9tcHQ7XHJcbiAgICAgICAgdGhpcy5lZGl0b3IgPSBuZXcgRWFzeUVkaXRvcihhcHAsdGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0X3BsdWdpbihuYW1lOnN0cmluZyl7XHJcbiAgICAgICAgcmV0dXJuICh0aGlzLmFwcCBhcyBhbnkpLnBsdWdpbnM/LnBsdWdpbnNbbmFtZV1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgbmMoKXtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRfcGx1Z2luKCdub3RlLWNoYWluJyk7XHJcbiAgICB9XHJcbn0iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsSUFBQUEsbUJBQThDOzs7QUNDdkMsSUFBTSxVQUFOLE1BQWE7QUFBQSxFQUVoQixjQUFhO0FBQ1QsUUFBSSxPQUFPLE9BQU8sYUFBYSxRQUFRLFVBQVU7QUFDakQsUUFBRyxNQUFLO0FBQ0osV0FBSyxXQUFXO0FBQUEsSUFDcEIsT0FBSztBQUNELFdBQUssV0FBVztBQUFBLElBQ3BCO0FBQUEsRUFDUDtBQUFBLEVBRUcsSUFBSSxtQkFBa0I7QUFDbEIsUUFBRyxLQUFLLFlBQVUsTUFBSztBQUNuQixhQUFPO0FBQUEsSUFDWCxPQUFLO0FBQ0QsYUFBTztBQUFBLElBQ1g7QUFBQSxFQUNKO0FBQUEsRUFFQSxJQUFJLG1CQUFrQjtBQUNsQixRQUFHLEtBQUssWUFBVSxNQUFLO0FBQ25CLGFBQU87QUFBQSxJQUNYLE9BQUs7QUFDRCxhQUFPO0FBQUEsSUFDWDtBQUFBLEVBQ0o7QUFDSjtBQUVPLElBQUksVUFBVSxJQUFJLFFBQVE7OztBQzdCakMsc0JBRU87QUFZQSxJQUFNLG1CQUErQjtBQUFBLEVBQzNDLGFBQVk7QUFBQSxFQUNaLFVBQVM7QUFDVjs7O0FDWEEsSUFBTSxrQkFBa0MsQ0FFeEM7QUFF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QUNKOzs7QUNqQ08sSUFBTSxVQUFOLE1BQWM7QUFBQSxFQU1qQixZQUFZLEtBQVU7QUFDbEIsU0FBSyxNQUFNO0FBQ1gsU0FBSyxpQkFBaUI7QUFDNUIsU0FBSyxnQkFBZ0I7QUFDZixTQUFLLFNBQVMsSUFBSSxXQUFXLEtBQUksSUFBSTtBQUFBLEVBQ3pDO0FBQUEsRUFFQSxXQUFXLE1BQVk7QUFyQjNCO0FBc0JRLFlBQVEsVUFBSyxJQUFZLFlBQWpCLG1CQUEwQixRQUFRO0FBQUEsRUFDOUM7QUFBQSxFQUVBLElBQUksS0FBSTtBQUNKLFdBQU8sS0FBSyxXQUFXLFlBQVk7QUFBQSxFQUN2QztBQUNKOzs7QVBsQkEsSUFBcUIsZ0JBQXJCLGNBQTJDLHdCQUFPO0FBQUEsRUFTakQsTUFBTSxTQUFTO0FBRWQsU0FBSyxJQUFJLFVBQVU7QUFBQSxNQUNsQixZQUFTO0FBQ1IsY0FBTSxLQUFLLFNBQVM7QUFBQSxNQUNyQjtBQUFBLElBQ0Q7QUFBQSxFQUNEO0FBQUEsRUFFQSxNQUFNLFdBQVc7QUFFaEIsU0FBSyxVQUFVLElBQUksUUFBUTtBQUMzQixVQUFNLEtBQUssYUFBYTtBQUV4QixTQUFLLE1BQU0sSUFBSSxRQUFRLEtBQUssR0FBRztBQUUvQixTQUFLLElBQUksVUFBVSxLQUFLO0FBR3hCLGdCQUFZLElBQUk7QUFBQSxFQUVqQjtBQUFBLEVBRUEsV0FBVztBQUFBLEVBRVg7QUFBQSxFQUVBLE1BQU0sZUFBZTtBQUNwQixTQUFLLFdBQVcsT0FBTyxPQUFPLENBQUMsR0FBRyxrQkFBa0IsTUFBTSxLQUFLLFNBQVMsQ0FBQztBQUFBLEVBQzFFO0FBQUEsRUFFQSxNQUFNLGVBQWU7QUFDcEIsVUFBTSxLQUFLLFNBQVMsS0FBSyxRQUFRO0FBQUEsRUFDbEM7QUFFRDsiLAogICJuYW1lcyI6IFsiaW1wb3J0X29ic2lkaWFuIiwgImltcG9ydF9vYnNpZGlhbiIsICJpbXBvcnRfb2JzaWRpYW4iLCAidmFsdWUiXQp9Cg==
